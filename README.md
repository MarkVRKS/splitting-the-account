# Сервис для деления счета в ресторанах (Bill Splitter)

## Описание

Сервис **Bill Splitter** предназначен для автоматизации процесса разделения счета в ресторане между несколькими участниками. Используя технологию OCR, сервис извлекает данные с чека, обрабатывает их и предлагает удобные способы распределения суммы.

## Проблематика

Разделение счета в группе людей часто приводит к следующим проблемам:
- **Ручной ввод данных с чека**: долго и подвержен ошибкам.
- **Неверный расчет долей**: особенно при наличии скидок, акций или чаевых.
- **Неудобство**: в определении, кто за что платил.

## Цель

Создать простой в использовании сервис, который:
- **Автоматически считывает чек через OCR**.
- **Предлагает различные варианты деления счета**.
- **Учитывает индивидуальные заказы, чаевые и скидки**.

## Архитектура

### Диаграмма архитектуры

````artifact
id: architecture-diagram
name: Архитектура сервиса
type: mermaid
content: |-
  graph TD
    A[Загрузка чека] --> B[OCR-модуль]
    B --> C[Парсинг результата]
    C --> D[Логика деления счета]
    D --> E[Пользовательский интерфейс]

### Основные модули

1. Модуль загрузки и обработки изображения чека
   - Поддерживает загрузку изображений в форматах JPG, PNG.
   - Выполняет предварительную обработку: улучшение контраста, выравнивание, удаление шума.

2. OCR-модуль
   - Отвечает за распознавание текста на чеке.
   - Возвращает сырую строку текста.

3. Модуль парсинга данных
   - Анализирует результат OCR и извлекает структурированные данные: названия блюд, цены, чаевые, общую сумму.

4. Модуль логики деления счета
   - Реализует алгоритмы деления: равномерное, пропорциональное, с учетом скидок и чаевых.
   - Обрабатывает пользовательские корректировки (например, исключение определенных позиций).

5. Модуль пользовательского интерфейса
   - Отображает чек, дает возможность выбора способа деления.
   - Предоставляет результат в виде таблицы или списка.

### Взаимодействие модулей

1. Пользователь загружает изображение чека.
2. Система применяет OCR и получает неструктурированный текст.
3. Текст анализируется и преобразуется в структурированные данные.
4. Пользователь выбирает метод деления.
5. Сервис рассчитывает доли и отображает результат.

---

## Выбор OCR-платформы

### Критерии выбора:
- Точность распознавания: особенно важно распознавание чисел и специальных символов.
- Стоимость: желательно open-source или недорогое решение.
- Интеграция с Python.
- Простота использования.

### Сравнение платформ:

| Платформа              | Точность | Стоимость | Интеграция | Простота | Комментарий |
|------------------------|----------|-----------|------------|----------|-------------|
| Tesseract OCR          | Средняя  | Бесплатно | ✅         | ✅        | Хорошо работает с печатными чеками |
| Google Cloud Vision API| Высокая  | Платно    | ✅         | ✅        | Отличная точность, но требует API-ключа |
| AWS Textract           | Очень высокая | Платно | ✅         | ❌        | Мощный, но сложнее в настройке |

### Рекомендуемое решение: Tesseract OCR

#### Преимущества:
- Open-source.
- Поддержка множества языков.
- Простота установки и интеграции.
- Хорошая производительность на типичных чеках.

Алгоритмы деления счета 
1. Равномерное деление 

Формула: 
доля_на_человека = общая_сумма / количество_людей 

Пример: 
Общая сумма: 6000 руб.
Количество людей: 3
→ Каждый платит: 2000 руб. 
2. Пропорциональное деление по заказам 

Формула: 
доля_i = (сумма_заказов_i / общая_сумма) * итоговая_сумма 

Пример:    

    Аня: 2000 руб.
    Боря: 1500 руб.
    Вика: 2500 руб.
    Итого: 6000 руб.
     

→ Аня: 2000/6000 × 6000 = 2000 руб.
→ Боря: 1500/6000 × 6000 = 1500 руб.
→ Вика: 2500/6000 × 6000 = 2500 руб. 
3. Деление с учетом чаевых и скидок 

Формула: 
итоговая_сумма = сумма_без_чаевых ± скидка + чаевые
доля_i = (сумма_заказов_i / сумма_без_чаевых) * итоговая_сумма 

Пример: 
Сумма без чаевых: 5000 руб.
Чаевые: 1000 руб.
Скидка: 500 руб.
Итого: 5500 руб. 

Аня: 2000 руб. → 2000/5000 × 5500 = 2200 руб. 
4. Индивидуальный вклад 

Позволяет указать, какие позиции заказал каждый участник. Расчет аналогичен пропорциональному, но только по выбранным позициям. 
Пользовательский интерфейс 
Концепция 

    Веб-интерфейс  (адаптирован под мобильные устройства).
    Возможность загрузки чека с камеры или галереи.
    Интерактивный список позиций с возможностью назначения участникам.
    Выбор способа деления.
    Отображение результатов в табличном виде.
     

Макет интерфейса 

    Поле для загрузки изображения чека .
    Список распознанных позиций  с ценами.
    Поля для ввода количества участников .
    Кнопки выбора способа деления .
    Таблица с результатами деления .
    Кнопка "Поделиться"  (по email или в мессенджер).
     

Логика работы пользователя 

    Загрузить изображение чека.
    Просмотреть и скорректировать распознанные данные.
    Выбрать способ деления.
    Получить результат.
    При необходимости — экспортировать или отправить.
     

Обработка ошибок 
Неверное распознавание OCR
  
Возможность вручную исправить данные
Неподдерживаемый формат файла
  
Сообщение об ошибке, повторная загрузка
Пустой чек
  
Уведомление о некорректном файле
Некорректный формат данных
  
Валидация и подсказки
 
 
Дальнейшее развитие 

    Интеграция с банковскими приложениями  (например, перевод по результатам расчета).
    Автоматическое определение валюты  и курсовой разницы.
    Добавление новых алгоритмов деления  (например, по категориям блюд).
    Мобильное приложение  с офлайн-режимом.
     

Инструкция по развертыванию (создание MVP не запланированно)
